{% extends "base.html" %}

{% block title %}Analytics - NCAA March Madness Predictor 2025{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="text-center mb-5">
        <h1 class="display-5 fw-bold">
            <i class="fas fa-chart-line text-warning me-3"></i>
            Tournament Analytics & Insights
        </h1>
        <p class="lead text-muted">
            Deep dive into 20+ years of NCAA tournament data and trends
        </p>
    </div>

    <!-- Chart Section -->
    {% if charts %}
    <div class="row mb-5">
        <div class="col-lg-6 mb-4">
            <div class="analytics-container">
                <h4 class="mb-3">
                    <i class="fas fa-trophy me-2"></i>
                    Seed Performance Analysis
                </h4>
                <div class="chart-container">
                    <div id="seedPerformanceChart"></div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6 mb-4">
            <div class="analytics-container">
                <h4 class="mb-3">
                    <i class="fas fa-chart-area me-2"></i>
                    Scoring Trends Over Time
                </h4>
                <div class="chart-container">
                    <div id="scoringTrendsChart"></div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Key Statistics -->
    <div class="row mb-5">
        <div class="col-lg-4 mb-4">
            <div class="analytics-container">
                <h4 class="mb-3">
                    <i class="fas fa-crown me-2"></i>
                    Championship Stats
                </h4>
                <div class="stat-grid">
                    <div class="stat-item">
                        <span class="stat-number">67%</span>
                        <span class="stat-label">#1 Seeds Win Rate</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">23</span>
                        <span class="stat-label">Different Champions Since 1985</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">3</span>
                        <span class="stat-label">Lowest Seed to Win (Villanova '85)</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 mb-4">
            <div class="analytics-container">
                <h4 class="mb-3">
                    <i class="fas fa-fire me-2"></i>
                    Upset Statistics
                </h4>
                <div class="upset-stats">
                    <div class="upset-stat">
                        <div class="upset-header">
                            <span class="upset-matchup">#16 vs #1</span>
                            <span class="upset-rate">1.5%</span>
                        </div>
                        <div class="upset-bar">
                            <div class="upset-fill" style="width: 1.5%;"></div>
                        </div>
                    </div>
                    
                    <div class="upset-stat">
                        <div class="upset-header">
                            <span class="upset-matchup">#15 vs #2</span>
                            <span class="upset-rate">8.9%</span>
                        </div>
                        <div class="upset-bar">
                            <div class="upset-fill" style="width: 8.9%;"></div>
                        </div>
                    </div>
                    
                    <div class="upset-stat">
                        <div class="upset-header">
                            <span class="upset-matchup">#12 vs #5</span>
                            <span class="upset-rate">35.4%</span>
                        </div>
                        <div class="upset-bar">
                            <div class="upset-fill" style="width: 35.4%;"></div>
                        </div>
                    </div>
                    
                    <div class="upset-stat">
                        <div class="upset-header">
                            <span class="upset-matchup">#11 vs #6</span>
                            <span class="upset-rate">42.1%</span>
                        </div>
                        <div class="upset-bar">
                            <div class="upset-fill" style="width: 42.1%;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 mb-4">
            <div class="analytics-container">
                <h4 class="mb-3">
                    <i class="fas fa-basketball-ball me-2"></i>
                    Game Metrics
                </h4>
                <div class="metric-list">
                    <div class="metric-item">
                        <i class="fas fa-bullseye text-success"></i>
                        <div>
                            <strong>Avg. FG%</strong>
                            <span>47.4% (Winners)</span>
                        </div>
                    </div>
                    
                    <div class="metric-item">
                        <i class="fas fa-target text-info"></i>
                        <div>
                            <strong>Avg. 3P%</strong>
                            <span>35.8% (Winners)</span>
                        </div>
                    </div>
                    
                    <div class="metric-item">
                        <i class="fas fa-hand-paper text-warning"></i>
                        <div>
                            <strong>Avg. FT%</strong>
                            <span>73.2% (Winners)</span>
                        </div>
                    </div>
                    
                    <div class="metric-item">
                        <i class="fas fa-chart-line text-danger"></i>
                        <div>
                            <strong>Avg. Margin</strong>
                            <span>11.7 points</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Interactive Features */
    <div class="row mb-5">
        <div class="col-lg-8">
            <div class="analytics-container">
                <h4 class="mb-3">
                    <i class="fas fa-search me-2"></i>
                    Historical Analysis Tools
                </h4>
                
                <div class="analysis-tools">
                    <div class="row g-3 mb-4">
                        <div class="col-md-4">
                            <label class="form-label">Analysis Type:</label>
                            <select class="form-select" id="analysisType">
                                <option value="seeds">Seed Performance</option>
                                <option value="conferences">Conference Strength</option>
                                <option value="upsets">Upset Analysis</option>
                                <option value="scoring">Scoring Trends</option>
                            </select>
                        </div>
                        
                        <div class="col-md-4">
                            <label class="form-label">Year Range:</label>
                            <select class="form-select" id="yearRange">
                                <option value="all">All Years (1985-2024)</option>
                                <option value="recent">Recent (2015-2024)</option>
                                <option value="modern">Modern Era (2000-2024)</option>
                            </select>
                        </div>
                        
                        <div class="col-md-4">
                            <label class="form-label">&nbsp;</label>
                            <button class="btn btn-primary w-100" onclick="runAnalysis()">
                                <i class="fas fa-play me-2"></i>Run Analysis
                            </button>
                        </div>
                    </div>
                    
                    <div id="analysisResults" class="analysis-results" style="display: none;">
                        <div class="results-header">
                            <h5 id="resultsTitle">Analysis Results</h5>
                        </div>
                        <div id="resultsContent" class="results-content">
                            <!-- Dynamic content will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <div class="analytics-container">
                <h4 class="mb-3">
                    <i class="fas fa-lightbulb me-2"></i>
                    Key Insights
                </h4>
                
                <div class="insights-feed">
                    <div class="insight-item">
                        <div class="insight-icon">
                            <i class="fas fa-trophy text-warning"></i>
                        </div>
                        <div class="insight-content">
                            <strong>Seed Power</strong>
                            <p>Lower seeds (1-4) have won 78% of all championships since 1985.</p>
                        </div>
                    </div>
                    
                    <div class="insight-item">
                        <div class="insight-icon">
                            <i class="fas fa-fire text-danger"></i>
                        </div>
                        <div class="insight-content">
                            <strong>March Madness</strong>
                            <p>12-5 matchups produce the most frequent upsets at 35.4% rate.</p>
                        </div>
                    </div>
                    
                    <div class="insight-item">
                        <div class="insight-icon">
                            <i class="fas fa-chart-line text-success"></i>
                        </div>
                        <div class="insight-content">
                            <strong>Evolution</strong>
                            <p>Average scoring has increased 8% since 2010 due to rule changes.</p>
                        </div>
                    </div>
                    
                    <div class="insight-item">
                        <div class="insight-icon">
                            <i class="fas fa-shield-alt text-info"></i>
                        </div>
                        <div class="insight-content">
                            <strong>Defense Wins</strong>
                            <p>Teams allowing <100 ppg win 73% more often in tournament.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Model Performance -->
    <div class="row">
        <div class="col-12">
            <div class="analytics-container">
                <h4 class="mb-3">
                    <i class="fas fa-robot me-2"></i>
                    ML Model Performance
                </h4>
                
                <div class="row g-4">
                    <div class="col-md-3">
                        <div class="performance-metric">
                            <div class="metric-value">91.4%</div>
                            <div class="metric-label">Overall Accuracy</div>
                            <div class="metric-description">Correctly predicts 9 out of 10 games</div>
                        </div>
                    </div>
                    
                    <div class="col-md-3">
                        <div class="performance-metric">
                            <div class="metric-value">0.979</div>
                            <div class="metric-label">AUC Score</div>
                            <div class="metric-description">Excellent ranking ability</div>
                        </div>
                    </div>
                    
                    <div class="col-md-3">
                        <div class="performance-metric">
                            <div class="metric-value">0.062</div>
                            <div class="metric-label">Brier Score</div>
                            <div class="metric-description">Well-calibrated probabilities</div>
                        </div>
                    </div>
                    
                    <div class="col-md-3">
                        <div class="performance-metric">
                            <div class="metric-value">1,382</div>
                            <div class="metric-label">Training Games</div>
                            <div class="metric-description">Rich historical dataset</div>
                        </div>
                    </div>
                </div>
                
                <div class="feature-importance mt-4">
                    <h5>Feature Importance Ranking:</h5>
                    <div class="feature-bars">
                        <div class="feature-bar">
                            <span class="feature-name">Seed Difference</span>
                            <div class="importance-bar">
                                <div class="importance-fill" style="width: 45%;"></div>
                            </div>
                            <span class="importance-value">45%</span>
                        </div>
                        
                        <div class="feature-bar">
                            <span class="feature-name">Field Goal %</span>
                            <div class="importance-bar">
                                <div class="importance-fill" style="width: 25%;"></div>
                            </div>
                            <span class="importance-value">25%</span>
                        </div>
                        
                        <div class="feature-bar">
                            <span class="feature-name">3-Point %</span>
                            <div class="importance-bar">
                                <div class="importance-fill" style="width: 15%;"></div>
                            </div>
                            <span class="importance-value">15%</span>
                        </div>
                        
                        <div class="feature-bar">
                            <span class="feature-name">Free Throw %</span>
                            <div class="importance-bar">
                                <div class="importance-fill" style="width: 10%;"></div>
                            </div>
                            <span class="importance-value">10%</span>
                        </div>
                        
                        <div class="feature-bar">
                            <span class="feature-name">Other Stats</span>
                            <div class="importance-bar">
                                <div class="importance-fill" style="width: 5%;"></div>
                            </div>
                            <span class="importance-value">5%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.stat-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1rem;
}

.stat-item {
    text-align: center;
    padding: 1rem;
    background: #f8fafc;
    border-radius: 8px;
}

.stat-number {
    display: block;
    font-size: 2rem;
    font-weight: 700;
    color: var(--primary-orange);
}

.stat-label {
    font-size: 0.9rem;
    color: #6b7280;
    font-weight: 500;
}

.upset-stat {
    margin-bottom: 1rem;
}

.upset-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.5rem;
}

.upset-matchup {
    font-weight: 600;
    color: var(--primary-blue);
}

.upset-rate {
    font-weight: 600;
    color: var(--primary-orange);
}

.upset-bar {
    height: 8px;
    background: #e5e7eb;
    border-radius: 4px;
    overflow: hidden;
}

.upset-fill {
    height: 100%;
    background: linear-gradient(135deg, var(--primary-orange) 0%, #ff8c42 100%);
    transition: width 1s ease;
}

.metric-list {
    space-y: 1rem;
}

.metric-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.75rem;
    background: #f8fafc;
    border-radius: 8px;
    margin-bottom: 0.75rem;
}

.metric-item i {
    font-size: 1.2rem;
}

.metric-item div strong {
    display: block;
    color: var(--primary-blue);
}

.metric-item div span {
    font-size: 0.9rem;
    color: #6b7280;
}

.analysis-results {
    background: #f8fafc;
    border-radius: 8px;
    padding: 1.5rem;
    border: 2px solid #e5e7eb;
}

.insights-feed {
    space-y: 1rem;
}

.insight-item {
    display: flex;
    gap: 1rem;
    padding: 1rem;
    background: #f8fafc;
    border-radius: 8px;
    margin-bottom: 1rem;
}

.insight-icon {
    flex-shrink: 0;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    background: white;
}

.insight-content strong {
    display: block;
    color: var(--primary-blue);
    margin-bottom: 0.25rem;
}

.insight-content p {
    font-size: 0.9rem;
    color: #6b7280;
    margin: 0;
}

.performance-metric {
    text-align: center;
    padding: 1.5rem;
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    border-radius: 12px;
    border: 2px solid transparent;
    transition: all 0.3s ease;
}

.performance-metric:hover {
    border-color: var(--primary-orange);
    transform: translateY(-2px);
}

.metric-value {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--primary-orange);
    margin-bottom: 0.5rem;
}

.metric-label {
    font-weight: 600;
    color: var(--primary-blue);
    margin-bottom: 0.25rem;
}

.metric-description {
    font-size: 0.8rem;
    color: #6b7280;
}

.feature-importance {
    background: #f8fafc;
    border-radius: 12px;
    padding: 1.5rem;
}

.feature-bar {
    display: grid;
    grid-template-columns: 150px 1fr 60px;
    align-items: center;
    gap: 1rem;
    margin-bottom: 0.75rem;
}

.feature-name {
    font-weight: 600;
    color: var(--primary-blue);
}

.importance-bar {
    height: 12px;
    background: #e5e7eb;
    border-radius: 6px;
    overflow: hidden;
}

.importance-fill {
    height: 100%;
    background: linear-gradient(135deg, var(--court-green) 0%, #16a34a 100%);
    transition: width 1s ease;
}

.importance-value {
    font-weight: 600;
    color: var(--primary-blue);
}
</style>
{% endblock %}

{% block scripts %}
<script>
// Render charts if data is available
{% if charts %}
document.addEventListener('DOMContentLoaded', function() {
    // Render seed performance chart
    {% if charts.seed_performance %}
    var seedChart = {{ charts.seed_performance|safe }};
    Plotly.newPlot('seedPerformanceChart', seedChart.data, seedChart.layout);
    {% endif %}
    
    // Render scoring trends chart
    {% if charts.scoring_trends %}
    var scoringChart = {{ charts.scoring_trends|safe }};
    Plotly.newPlot('scoringTrendsChart', scoringChart.data, scoringChart.layout);
    {% endif %}
});
{% endif %}

function runAnalysis() {
    const analysisType = document.getElementById('analysisType').value;
    const yearRange = document.getElementById('yearRange').value;
    const resultsDiv = document.getElementById('analysisResults');
    const titleDiv = document.getElementById('resultsTitle');
    const contentDiv = document.getElementById('resultsContent');
    
    // Show loading state
    titleDiv.textContent = 'Running Analysis...';
    contentDiv.innerHTML = '<div class="text-center"><i class="fas fa-spinner fa-spin fa-2x"></i></div>';
    resultsDiv.style.display = 'block';
    
    // Simulate analysis (in real app, this would call the API)
    setTimeout(() => {
        titleDiv.textContent = `${analysisType.charAt(0).toUpperCase() + analysisType.slice(1)} Analysis Results`;
        
        let content = '';
        switch(analysisType) {
            case 'seeds':
                content = `
                    <div class="analysis-result">
                        <h6>Key Findings:</h6>
                        <ul>
                            <li>#1 seeds win 78.5% of first-round games</li>
                            <li>Biggest upset: #16 UMBC over #1 Virginia (2018)</li>
                            <li>Most reliable seeds: #1, #2, #3 in early rounds</li>
                        </ul>
                    </div>
                `;
                break;
            case 'conferences':
                content = `
                    <div class="analysis-result">
                        <h6>Conference Strength Rankings:</h6>
                        <ol>
                            <li>ACC - 67% tournament win rate</li>
                            <li>Big Ten - 64% tournament win rate</li>
                            <li>Big 12 - 62% tournament win rate</li>
                            <li>SEC - 59% tournament win rate</li>
                        </ol>
                    </div>
                `;
                break;
            case 'upsets':
                content = `
                    <div class="analysis-result">
                        <h6>Upset Patterns:</h6>
                        <ul>
                            <li>12 vs 5: Most frequent upset (35.4%)</li>
                            <li>Peak upset years: 2014, 2018, 2021</li>
                            <li>First weekend sees 85% of all upsets</li>
                        </ul>
                    </div>
                `;
                break;
            case 'scoring':
                content = `
                    <div class="analysis-result">
                        <h6>Scoring Evolution:</h6>
                        <ul>
                            <li>Average game total: 139.2 points</li>
                            <li>Highest-scoring era: 2015-2020</li>
                            <li>3-point shot impact: +12% since 2010</li>
                        </ul>
                    </div>
                `;
                break;
        }
        
        contentDiv.innerHTML = content;
    }, 1500);
}

// Add animation to performance metrics
document.addEventListener('DOMContentLoaded', function() {
    const metrics = document.querySelectorAll('.performance-metric');
    metrics.forEach((metric, index) => {
        setTimeout(() => {
            metric.style.opacity = '1';
            metric.style.transform = 'translateY(0)';
        }, index * 100);
    });
});
</script>
{% endblock %} 